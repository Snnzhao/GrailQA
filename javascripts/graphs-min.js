function clear_graph(t){const e="graph_"+t;document.getElementById(e).innerHTML="",simulation.stop()}function generate_graph(t,e){e.edges.forEach(function(t,r){e.edges[r].source=e.edges[r].start,e.edges[r].target=e.edges[r].end});const r="graph_"+t;document.getElementById(r).innerHTML="";var n=document.getElementById(r).width.baseVal.value,a=document.getElementById(r).height.baseVal.value,o=d3.select("#"+r).attr("width",n).attr("height",a);simulation=d3.forceSimulation(e.nodes).force("link",d3.forceLink(e.edges).id(function(t){return t.nid})).force("charge",d3.forceManyBody().strength(-100)).force("center",d3.forceCenter(n/2,a/2)).force("collide",d3.forceCollide(function(){return 65}));const i=.1*Math.sqrt(n*a)/e.nodes.length;o.append("defs").append("marker").attr("id","arrowhead").attr("viewBox","0 -5 10 10").attr("refX",38).attr("refY",0).attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").append("svg:path").attr("fill","#888").attr("d","M0,-5L10,0L0,5");const d=o.append("g").attr("fill","none").attr("stroke-width",1.5).selectAll("path").data(e.edges).join("path").attr("stroke","#888").attr("marker-end",function(){return"url(#arrowhead)"}),l=o.selectAll(".edgepath").data(e.edges).enter().append("path").attr("class","edgepath").attr("fill-opacity",0).attr("stroke-opacity",0).attr("id",function(t,e){return"edgepath"+e}).style("pointer-events","none"),c=o.selectAll(".edgelabel").data(e.edges).enter().append("text").attr("class","edgelabel").attr("id",function(t,e){return"edgelabel"+e}).attr("font-size",10).attr("fill","#000").style("pointer-events","none");c.append("textPath").attr("xlink:href",function(t,e){return"#edgepath"+e}).style("text-anchor","middle").style("pointer-events","none").attr("startOffset","50%").text(function(t){return t.friendly_name});const s=o.append("g").attr("fill","currentColor").attr("stroke-linecap","round").attr("stroke-linejoin","round").selectAll("g").data(e.nodes).join("g").call(function(t){function e(e,r){e.active||t.alphaTarget(.3).restart(),r.fx=r.x,r.fy=r.y}function r(t,e){e.fx=t.x,e.fy=t.y}function n(e,r){e.active||t.alphaTarget(0),r.fx=null,r.fy=null}return d3.drag().on("start",e).on("drag",r).on("end",n)}(simulation));s.append("circle").attr("stroke","white").attr("stroke-width",1.5).attr("r",i).attr("fill",function(t){return 0!=t.nid?"#d8ab1f":"#7e7e7e"}),s.append("text").attr("x",i+1).attr("y",3).text(function(t){return t.friendly_name+":"+t.node_type}),s.on("dblclick",function(t,r){return console.log(e.nodes[r.index])});var u=function(t){return"M"+t.source.x+","+t.source.y+"A0,0 0 0,1 "+t.target.x+","+t.target.y};simulation.on("tick",function(){s.attr("transform",function(t){return t.x=Math.max(i,Math.min(n-i,t.x)),t.y=Math.max(i,Math.min(a-i,t.y)),"translate("+t.x+","+t.y+")"}),d.attr("d",u),l.attr("d",function(t){return"M "+t.source.x+" "+t.source.y+" L "+t.target.x+" "+t.target.y}),c.attr("transform",function(t){if(t.target.x<t.source.x){var e=this.getBBox();return rx=e.x+e.width/2,ry=e.y+e.height/2,"rotate(180 "+rx+" "+ry+")"}return"rotate(0)"})})}var simulation=0;